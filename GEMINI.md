# GEMINI.md

このファイルは、Geminiがこのプロジェクトを理解し、開発をサポートするための指示書です。

## プロジェクト概要

このプロジェクトは、`ccusage`コマンドで取得したAnthropic Claudeの月間利用料金を、Slackのプロフィールステータスに自動で更新するNode.jsアプリケーションです。

主な機能は以下の通りです。

-   1分ごとに`ccusage`コマンドを実行し、最新の利用料金を取得します。
-   利用料金に応じて、`messages.json`で定義されたメッセージテンプレートと絵文字を使って、Slackのステータスを更新します。
-   利用料金が$200未満の場合はランダムなメッセージ、$200〜$212の場合は「食べ放題中」、$212を超える場合は節約額に応じた比較メッセージが表示されます。
-   `gacha.js`と`gacha-handler.js`を使って、`messages.json`の内容をガチャ形式で楽しく生成・管理できます。

## 主要なファイル

-   `index.js`: メインのアプリケーションロジック。`ccusage`の実行、Slack APIへのリクエスト、定期実行のスケジューリングを行います。
-   `package.json`: プロジェクトの依存関係とスクリプトを定義しています。
-   `messages.json`: Slackに表示するメッセージのテンプレートや比較対象を定義する設定ファイルです。
-   `gacha.js`: メッセージガチャを引くためのCLIツールです。
-   `gacha-handler.js`: ガチャのリクエストを監視し、実際にメッセージセットを生成するハンドラです。
-   `.env.example`: 環境変数のテンプレート。`SLACK_TOKEN`が必要です。
-   `README.md`: セットアップ方法や使い方が記載されています。

## 開発における規約

### 1. 依存関係

-   APIリクエストには`axios`を使用します。
-   定期実行には`node-cron`を使用します。
-   環境変数の読み込みには`dotenv`を使用します。
-   新しいnpmパッケージを追加した場合は、`package.json`に追記し、`npm install`を実行してください。

### 2. コーディングスタイル

-   既存のコードスタイル（インデント、命名規則など）に従ってください。
-   非同期処理は`async/await`を基本とします。
-   コンソール出力には、成功時には`✅`、エラー時には`❌`、処理中には`🔄`や`⏰`などの絵文字を接頭辞として付けると分かりやすいです。

### 3. Slack API

-   Slack APIとの通信は`index.js`内の`updateSlackProfile`関数に集約されています。
-   ステータス更新には`users.profile.set`メソッドを使用します。
-   必要なスコープは`users.profile:write`です。

### 4. ガチャ機能

-   ガチャのロジックを変更する場合は`gacha.js`と`gacha-handler.js`を修正します。
-   新しいメッセージカテゴリを追加する場合は、`gacha-handler.js`の`generators`オブジェクトに新しいキーと生成ロジックを追加してください。
-   生成されたメッセージは`gacha-results/`に保存され、`collection.json`で管理されます。

### 5. コマンド

-   **通常起動:** `npm start`
-   **ガチャを引く:** `node gacha.js`
-   **ガチャの結果を適用:** `node gacha.js --apply [ファイル名]`
-   **ガチャハンドラ起動:** `node gacha-handler.js --watch`

何か新しい機能を追加したり、既存のコードを修正したりする際は、これらの情報を参考にしてください。
